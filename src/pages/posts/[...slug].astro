---
import type { GetStaticPaths } from "astro";
import { render, getEntry } from "astro:content";

import Layout from "@/layouts/Layout.astro";
import PostCard from "@/components/PostCard.astro";
import { getSortedPosts } from "@/lib/content-util";
import Link from "@/components/ui/Link.astro";

export const getStaticPaths = (async () => {
  const posts = await getSortedPosts();
  return posts.map((post) => ({
    params: { slug: post.data.slug },
    props: { post },
  }));
}) satisfies GetStaticPaths;

const { post } = Astro.props;
const { Content, headings } = await render(post);
const previousPost =
  post.data.previousPostSlug &&
  (await getEntry("post", post.data.previousPostSlug));

const nextPost =
  post.data.nextPostSlug && (await getEntry("post", post.data.nextPostSlug));
---

<Layout>
  <div class="flex flex-col gap-2">
    <div class="onload-animation card p-6">
      <div class="flex flex-col gap-1">
        <PostCard post={post} />
      </div>
      <div
        class="relative py-4 before:absolute before:w-full before:border-t before:border-dashed"
      >
      </div>
      <article class="prose onload-animation">
        <Content />
      </article>
    </div>
    <div class="grid grid-cols-[1fr_1fr] gap-2">
      {
        previousPost && (
          <Link
            class="btn col-start-1"
            href={`/posts/${previousPost.data.slug}`}
          >
            {previousPost.data.title}
          </Link>
        )
      }
      {
        nextPost && (
          <Link class="btn col-start-2" href={`/posts/${nextPost.data.slug}`}>
            {nextPost.data.title}
          </Link>
        )
      }
    </div>
  </div>
</Layout>
